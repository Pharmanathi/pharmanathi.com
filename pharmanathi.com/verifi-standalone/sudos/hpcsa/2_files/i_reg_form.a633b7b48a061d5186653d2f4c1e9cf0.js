
RightNow.namespace('Custom.Widgets.searchForm.iRegisterForm');Custom.Widgets.searchForm.iRegisterForm=RightNow.Widgets.extend({constructor:function(){this._registrationCodeNumber=this.Y.one('#rn_'+this.instanceID+'_registrationCodeNumber');this._fullName=this.Y.one('#rn_'+this.instanceID+'_fullName');this._surName=this.Y.one('#rn_'+this.instanceID+'_surName');this._city=this.Y.one('#rn_'+this.instanceID+'_city');this._postalCode=this.Y.one('#rn_'+this.instanceID+'_postalCode');this._register=this.Y.one('#rn_'+this.instanceID+'_register');this._categorySelect=this.Y.one('#rn_'+this.instanceID+'_categorySelect');this._registerSelect=this.Y.one('#rn_'+this.instanceID+'_registerSelect');this._registerListTbl=null;this._registerListData=null;this._surnameAppend=null;this._firstnameAppend=null;this._middlenameAppend=null;this._cityAppend=null;this._postalCodeAppend=null;this._registerAppend=null;this._serialListData=null;this._space=null;this._prodContainer=document.getElementById('rn_'+this.instanceID+'_serialListGrid');this._totalRecords=document.getElementById('total_records_found');this._fullNameESelect=this.Y.one('#rn_'+this.instanceID+'_fullNameERadio');this._fullNameESelect.on("click",this._checkFullNameERadioTypeOption,this);this._fullNameWSelect=this.Y.one('#rn_'+this.instanceID+'_fullNameWRadio');this._fullNameWSelect.on("click",this._checkFullNameWRadioTypeOption,this);this._surNameESelect=this.Y.one('#rn_'+this.instanceID+'_surNameERadio');this._surNameESelect.on("click",this._checkSurnameERadioTypeOption,this);this._surNameWSelect=this.Y.one('#rn_'+this.instanceID+'_surNameWRadio');this._surNameWSelect.on("click",this._checkSurnameWRadioTypeOption,this);this._cityESelect=this.Y.one('#rn_'+this.instanceID+'_cityERadio');this._cityESelect.on("click",this._checkCityERadioTypeOption,this);this._cityWSelect=this.Y.one('#rn_'+this.instanceID+'_cityWRadio');this._cityWSelect.on("click",this._checkCityWRadioTypeOption,this);this._postalESelect=this.Y.one('#rn_'+this.instanceID+'_postalCodeERadio');this._postalESelect.on("click",this._checkPostalERadioTypeOption,this);this._postalWSelect=this.Y.one('#rn_'+this.instanceID+'_postalCodeWRadio');this._postalWSelect.on("click",this._checkPostalWRadioTypeOption,this);this._registerNumberPrefix="";this._registerNumberSuffix="";this._isFirstNameWildChecked=false;this._isLastNameWildChecked=false;this._isSurNameWildChecked=false;this._isIdNumberWildChecked=false;this._isCityWildChecked=false;this._isPostalWildChecked=false;this._isRegisterWildChecked=false;this._searchButton=this.Y.one('#rn_'+this.instanceID+'_Search_Button_for_iRegister');this._resetButton=this.Y.one('#rn_'+this.instanceID+'_Reset_Button_for_iRegister');this._searchButton.on("click",this._searchRegisterDetails,this);this._resetButton.on("click",this._resetRegisterDetails,this);},_checkFullNameWRadioTypeOption:function(e){this._isFirstNameWildChecked=true;},_checkFullNameERadioTypeOption:function(e){this._isFirstNameWildChecked=false;},_checkSurnameWRadioTypeOption:function(e){this._isSurnameWildChecked=true;},_checkSurnameERadioTypeOption:function(e){this._isSurnameWildChecked=false;},_checkCityWRadioTypeOption:function(e){this._isCityWildChecked=true;},_checkCityERadioTypeOption:function(e){this._isCityWildChecked=false;},_checkPostalWRadioTypeOption:function(e){this._isPostalWildChecked=true;},_checkPostalERadioTypeOption:function(e){this._isPostalWildChecked=false;},_searchRegisterDetails:function(e){if(this._registrationCodeNumber.get('value')==""&&this._fullName.get('value')==""&&this._surName.get('value')==""&&this._city.get('value')==""&&this._postalCode.get('value')==""&&this._registerSelect.get('value')==""&&this._categorySelect.get('value')==""){alert("Please enter the values");return;};window.WaitPanel.show();var fullNameArr=this._fullName.get('value').split(' ');console.log("Name-"+fullNameArr[0]+fullNameArr[1]);var eventObject=new RightNow.Event.EventObject(this,{data:{regNumber:this._registrationCodeNumber.get('value'),firstName:this._isFirstNameWildChecked?'*'+fullNameArr[0]+'*':fullNameArr[0],middleName:this._isLastNameWildChecked?'*'+fullNameArr[1]+'*':fullNameArr[1],surName:this._isSurNameWildChecked?'*'+this._surName.get('value')+'*':this._surName.get('value'),city:this._isCityWildChecked?'*'+this._city.get('value')+'*':this._city.get('value'),postalCode:this._isPostalWildChecked?'*'+this._postalCode.get('value')+'*':this._postalCode.get('value'),register:this._registerSelect.get('value'),category:this._categorySelect.get('value')}});RightNow.Ajax.makeRequest('/cc/ReportController/getDataFromRnow',eventObject.data,{successHandler:this._onQueryRegisterResponseReceived,scope:this,data:eventObject,json:true,timeout:480000});},_resetRegisterDetails:function(e){this._registrationCodeNumber.set('value',null);this._fullName.set('value',null);this._surName.set('value',null);this._city.set('value',null);this._postalCode.set('value',null);this._registerSelect.set('value',null);this._categorySelect.set('value',null);this._prodContainer.innerHTML='';this._totalRecords.innerHTML='';},_parseIRegister:function(resp){var arrData=[];var i;for(i=0;i<resp.data.length;i++){var obj={"title":resp.data[i][0],"surname":resp.data[i][1],"full_name":resp.data[i][2],"registration_number":resp.data[i][3],"city":resp.data[i][4],"postal_code":resp.data[i][5],"categories":resp.data[i][6],"status":resp.data[i][7]};arrData.push(obj);}
return arrData;},_onQueryRegisterResponseReceived:function(resp,args){window.WaitPanel.hide();var serialList=this._parseIRegister(resp);this._serialListData=serialList;this._showIRegisterTable(resp.data.length);},_searchRender:function(e){e.preventDefault();this._registerNumberPrefix=this._inputBox.get('value');this._appendCode_number();},_appendCode_number:function(){var space="";switch(this._registerNumberPrefix.length){case 2:space=this._registerNumberPrefix.concat("   ");break;case 3:space=this._registerNumberPrefix.concat("  ");break;case 4:space=this._registerNumberPrefix.concat(" ");}
this._registrationCodeNumber.set('value',space+this._registerNumberSuffix);},_getRegisterNumber:function(e){this._registerNumberSuffix=e.target.get('value');this._appendCode_number();},_showIRegisterTable:function(dataLength){this._totalRecords.innerHTML='Total Records Found: '+dataLength;function getInputBox(o){var reg=o.data.registration_number;var url="<div><a href='/app/iregister_details/reg_number/"+reg+"' target='_blank' />View</div>";return url;}
var columnDef=[{key:"title",label:"Title",sortable:true,className:"alignLeft",allowHTML:true},{key:"surname",label:"Surname",className:"alignLeft",sortable:true,allowHTML:true},{key:"full_name",label:"Fullname",className:"alignLeft",sortable:true,allowHTML:true},{key:"registration_number",label:"Registration",className:"alignLeft",sortable:true,allowHTML:true},{key:"city",label:"City",className:"alignLeft",sortable:true,allowHTML:true},{key:"postal_code",label:"Postal Code",className:"alignLeft",sortable:true,allowHTML:true},{key:"status",label:"Status",className:"alignLeft",sortable:true,allowHTML:true},{key:" ",label:"",sortable:false,formatter:getInputBox,allowHTML:true,className:"alignCenter"}];this._prodContainer.innerHTML='';this._serialListTbl=null;this._serialListTbl=new this.Y.DataTable({columns:columnDef,data:this._serialListData,scrollable:"y",paginatorLocation:['footer'],rowsPerPage:5});this._serialListTbl.render('#rn_'+this.instanceID+'_serialListGrid');},});